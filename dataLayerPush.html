<script>
const datalayerSource = (callback, dataLayer = window.dataLayer || []) => {
  // dataLayer is an optional second parameter to handle dispense cart;
  const originalPush = dataLayer.push;
  dataLayer.push = (...args) => {
    originalPush(...args);
    callback(dataLayer.slice(-1)[0]); // Gets the newest array member of dataLayer
  };
};
datalayerSource((data) => {
    if(data.event === "purchase") {
            const { id, revenue, shipping } = data.ecommerce.purchase.actionField;
            const { category, currency, name, price, quantity } = data.ecommerce.purchase.products[0];
            const item_id = data.ecommerce.purchase.products[0].id;

            window.tracker(
                    "addTrans",
                    id,
                    "N/A",
                    parseFloat(revenue) || 0,
                    0,
                    parseFloat(shipping) || 0,
                    "N/A",
                    "N/A",
                    "USD"
                );

            window.tracker(
                "addItem",
                id,
                item_id || "N/A",
                name || "N/A",
                category || "N/A",
                parseFloat(price) || 0,
                parseInt(quantity) || 1,
                currency || "USD"
            );
            window.tracker("trackTrans");
        }
});
</script>