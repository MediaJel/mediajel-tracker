{"mappings":"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","sources":["<anon>","src/shared/environment-data-sources/dutchie-iframe.ts","src/shared/sources/post-message-source.ts","src/shared/utils/try-parse-json.ts"],"sourcesContent":["(function () {\n\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  var parcelRequire = $parcel$global[\"parcelRequire07df\"];\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"45EB9\", function(module, exports) {\n\n$parcel$export(module.exports, \"default\", function () { return $4e64b30933aa960a$export$2e2bcd8739ae039; });\n\nvar $2hYdk = parcelRequire(\"2hYdk\");\n\nvar $5ayqG = parcelRequire(\"5ayqG\");\n\nvar $gDdCy = parcelRequire(\"gDdCy\");\nconst $4e64b30933aa960a$var$dutchieIframeDataSource = ()=>{\n    (0, $5ayqG.postMessageSource)((event)=>{\n        var _rawData_payload;\n        const rawData = (0, $gDdCy.tryParseJSONObject)(event.data);\n        const payload = (rawData === null || rawData === void 0 ? void 0 : (_rawData_payload = rawData.payload) === null || _rawData_payload === void 0 ? void 0 : _rawData_payload.payload) || null;\n        if (rawData.event === \"analytics:dataLayer\" && payload.event === \"add_to_cart\") {\n            const products = payload.ecommerce.items;\n            const { item_id: item_id, item_name: item_name, item_category: item_category, price: price, quantity: quantity } = products[0];\n            (0, $2hYdk.default).notify({\n                addToCartEvent: {\n                    sku: item_id.toString(),\n                    name: (item_name === null || item_name === void 0 ? void 0 : item_name.toString()) || \"N/A\",\n                    category: (item_category === null || item_category === void 0 ? void 0 : item_category.toString()) || \"N/A\",\n                    unitPrice: parseFloat(price || \"0\"),\n                    quantity: parseInt(quantity || \"1\"),\n                    currency: \"USD\"\n                }\n            });\n        }\n        if (rawData.event === \"analytics:dataLayer\" && payload.event === \"remove_from_cart\") {\n            const products = payload.ecommerce.items;\n            const { item_id: item_id, item_name: item_name, item_category: item_category, price: price, quantity: quantity } = products[0];\n            (0, $2hYdk.default).notify({\n                removeFromCartEvent: {\n                    sku: item_id.toString(),\n                    name: (item_name === null || item_name === void 0 ? void 0 : item_name.toString()) || \"N/A\",\n                    category: (item_category === null || item_category === void 0 ? void 0 : item_category.toString()) || \"N/A\",\n                    unitPrice: parseFloat(price || \"0\"),\n                    quantity: parseInt(quantity || \"1\"),\n                    currency: \"USD\"\n                }\n            });\n        }\n        if (rawData.event === \"analytics:dataLayer\" && rawData.payload.payload[\"1\"] === \"purchase\") try {\n            const transaction = rawData.payload.payload[\"2\"];\n            const products = transaction.items;\n            const { transaction_id: transaction_id, value: value } = transaction;\n            (0, $2hYdk.default).notify({\n                transactionEvent: {\n                    id: transaction_id.toString(),\n                    total: parseFloat(value || 0),\n                    tax: 0,\n                    shipping: 0,\n                    city: \"N/A\",\n                    state: \"N/A\",\n                    country: \"N/A\",\n                    currency: \"USD\",\n                    items: products.map((product)=>{\n                        const { item_id: item_id, item_name: item_name, item_category: item_category, price: price, quantity: quantity } = product;\n                        return {\n                            orderId: transaction_id.toString(),\n                            productId: item_id.toString(),\n                            sku: item_id.toString(),\n                            name: (item_name || \"N/A\").toString(),\n                            category: (item_category || \"N/A\").toString(),\n                            unitPrice: parseFloat(price || 0),\n                            quantity: parseInt(quantity || 1),\n                            currency: \"USD\"\n                        };\n                    })\n                }\n            });\n        } catch (error) {\n        // window.tracker(\"trackError\", JSON.stringify(error), \"DUTCHIEIFRAME\");\n        }\n        if (rawData.event == \"analytics:dataLayer\" && payload.event == \"purchase\") try {\n            const transaction = payload.ecommerce;\n            const products = transaction.items;\n            const { transaction_id: transaction_id, value: value } = transaction;\n            (0, $2hYdk.default).notify({\n                transactionEvent: {\n                    id: transaction_id.toString(),\n                    total: parseFloat(value || 0),\n                    tax: 0,\n                    shipping: 0,\n                    city: \"N/A\",\n                    state: \"N/A\",\n                    country: \"N/A\",\n                    currency: \"USD\",\n                    items: products.map((product)=>{\n                        const { item_id: item_id, item_name: item_name, item_category: item_category, price: price, quantity: quantity } = product;\n                        return {\n                            orderId: transaction_id.toString(),\n                            productId: item_id.toString(),\n                            sku: item_id.toString(),\n                            name: (item_name || \"N/A\").toString(),\n                            category: (item_category || \"N/A\").toString(),\n                            unitPrice: parseFloat(price || 0),\n                            quantity: parseInt(quantity || 1),\n                            currency: \"USD\"\n                        };\n                    })\n                }\n            });\n        } catch (error) {\n        // window.tracker(\"trackError\", JSON.stringify(error), \"DUTCHIEIFRAME\");\n        }\n    });\n};\nvar $4e64b30933aa960a$export$2e2bcd8739ae039 = $4e64b30933aa960a$var$dutchieIframeDataSource;\n\n});\nparcelRegister(\"5ayqG\", function(module, exports) {\n\n$parcel$export(module.exports, \"postMessageSource\", function () { return $5b9746592ec0dabd$export$653284ea2e114aa2; });\nconst $5b9746592ec0dabd$export$653284ea2e114aa2 = (callback)=>{\n    window.addEventListener(\"message\", callback, false);\n};\n\n});\n\nparcelRegister(\"gDdCy\", function(module, exports) {\n\n$parcel$export(module.exports, \"tryParseJSONObject\", function () { return $3314a60fcd51e41f$export$8b0f5bf83db88e; });\nconst $3314a60fcd51e41f$export$8b0f5bf83db88e = (event)=>{\n    try {\n        if (typeof event === \"object\") return event;\n        if (typeof event === \"string\") return JSON.parse(event);\n    } catch (e) {\n        console.error(\"Error parsing event:\", e);\n    }\n    return event;\n};\n\n});\n\n\n})();\n//# sourceMappingURL=dutchie-iframe.1417c9c6.js.map\n","import observable from \"src/shared/utils/create-events-observable\";\n\nimport { postMessageSource } from \"../sources/post-message-source\";\nimport { TransactionCartItem } from \"../types\";\nimport { tryParseJSONObject } from \"../utils/try-parse-json\";\n\nconst dutchieIframeDataSource = () => {\n  postMessageSource((event: MessageEvent<any>) => {\n    const rawData = tryParseJSONObject(event.data);\n    const payload = rawData?.payload?.payload || null;\n\n    if (rawData.event === \"analytics:dataLayer\" && payload.event === \"add_to_cart\") {\n      const products = payload.ecommerce.items;\n      const { item_id, item_name, item_category, price, quantity } = products[0];\n\n      observable.notify({\n        addToCartEvent: {\n          sku: item_id.toString(),\n          name: item_name?.toString() || \"N/A\",\n          category: item_category?.toString() || \"N/A\",\n          unitPrice: parseFloat(price || \"0\"),\n          quantity: parseInt(quantity || \"1\"),\n          currency: \"USD\",\n        },\n      });\n    }\n\n    if (rawData.event === \"analytics:dataLayer\" && payload.event === \"remove_from_cart\") {\n      const products = payload.ecommerce.items;\n      const { item_id, item_name, item_category, price, quantity } = products[0];\n\n      observable.notify({\n        removeFromCartEvent: {\n          sku: item_id.toString(),\n          name: item_name?.toString() || \"N/A\",\n          category: item_category?.toString() || \"N/A\",\n          unitPrice: parseFloat(price || \"0\"),\n          quantity: parseInt(quantity || \"1\"),\n          currency: \"USD\",\n        },\n      });\n    }\n\n    if (rawData.event === \"analytics:dataLayer\" && rawData.payload.payload[\"1\"] === \"purchase\") {\n      try {\n        const transaction = rawData.payload.payload[\"2\"];\n        const products = transaction.items;\n        const { transaction_id, value } = transaction;\n\n        observable.notify({\n          transactionEvent: {\n            id: transaction_id.toString(),\n            total: parseFloat(value || 0),\n            tax: 0,\n            shipping: 0,\n            city: \"N/A\",\n            state: \"N/A\",\n            country: \"N/A\",\n            currency: \"USD\",\n            items: products.map((product) => {\n              const { item_id, item_name, item_category, price, quantity } = product;\n              return {\n                orderId: transaction_id.toString(),\n                productId: item_id.toString(),\n                sku: item_id.toString(),\n                name: (item_name || \"N/A\").toString(),\n                category: (item_category || \"N/A\").toString(),\n                unitPrice: parseFloat(price || 0),\n                quantity: parseInt(quantity || 1),\n                currency: \"USD\",\n              } as TransactionCartItem;\n            }),\n          },\n        });\n      } catch (error) {\n        // window.tracker(\"trackError\", JSON.stringify(error), \"DUTCHIEIFRAME\");\n      }\n    }\n\n    if (rawData.event == \"analytics:dataLayer\" && payload.event == \"purchase\") {\n      try {\n        const transaction = payload.ecommerce;\n        const products = transaction.items;\n        const { transaction_id, value } = transaction;\n\n        observable.notify({\n          transactionEvent: {\n            id: transaction_id.toString(),\n            total: parseFloat(value || 0),\n            tax: 0,\n            shipping: 0,\n            city: \"N/A\",\n            state: \"N/A\",\n            country: \"N/A\",\n            currency: \"USD\",\n            items: products.map((product) => {\n              const { item_id, item_name, item_category, price, quantity } = product;\n              return {\n                orderId: transaction_id.toString(),\n                productId: item_id.toString(),\n                sku: item_id.toString(),\n                name: (item_name || \"N/A\").toString(),\n                category: (item_category || \"N/A\").toString(),\n                unitPrice: parseFloat(price || 0),\n                quantity: parseInt(quantity || 1),\n                currency: \"USD\",\n              } as TransactionCartItem;\n            }),\n          },\n        });\n      } catch (error) {\n        // window.tracker(\"trackError\", JSON.stringify(error), \"DUTCHIEIFRAME\");\n      }\n    }\n  });\n};\n\nexport default dutchieIframeDataSource;\n","\nexport const postMessageSource = (callback: (event: MessageEvent<any>) => void): void => {\n    window.addEventListener(\"message\", callback, false)\n}","export const tryParseJSONObject = (event: string | object): string | object | any => {\n  try {\n    if (typeof event === \"object\") {\n      return event;\n    }\n    if (typeof event === \"string\") {\n      return JSON.parse(event);\n    }\n  } catch (e) {\n    console.error(\"Error parsing event:\", e);\n  }\n\n  return event;\n};\n"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","parcelRequire","$parcel$global","globalThis","self","window","global","parcelRegister","register","module","exports","$4e64b30933aa960a$export$2e2bcd8739ae039","$2hYdk","$5ayqG","$gDdCy","postMessageSource","event","_rawData_payload","rawData","tryParseJSONObject","data","payload","item_id","item_name","item_category","price","quantity","products","ecommerce","items","default","notify","addToCartEvent","sku","toString","name","category","unitPrice","parseFloat","parseInt","currency","removeFromCartEvent","transaction","transaction_id","value","transactionEvent","id","total","tax","shipping","city","state","country","map","product","orderId","productId","error","$5b9746592ec0dabd$export$653284ea2e114aa2","callback","addEventListener","$3314a60fcd51e41f$export$8b0f5bf83db88e","JSON","parse","console"],"version":3,"file":"dutchie-iframe.1417c9c6.js.map"}